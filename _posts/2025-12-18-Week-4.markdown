---
layout: post
title:  "Week 4"
categories: jekyll update
---

## Assets:

Since the user is supposed to advance in the game by exploring the dungeon, once they have fully explored a floor and defeated all enemies, there should be a way to proceed to the next level.
To do this, a new floor must be generated.
In order to make this possible, we decided that the player must interact with an element in the game.
In our case, a trapdoor.
This trapdoor was created together with the appropriate base, metallic, and normal textures in Blender.

<img width="300"  alt="Trapdoor" src="{{site.imgpath}}/trapdoor.png">

To enhance our shop, which can be found in the dungeon, a model of an old table was created.
Wood and fabric materials and the corresponding textures were created for this table.

<img width="300"  alt="Table" src="{{site.imgpath}}/table.png">

To make the existing skeleton soldier more visually appealing, suitable color and metallic textures were created.

<img width="300"  alt="Textured Skeleton" src="{{site.imgpath}}/textured-skeleton.png">

By Rene Tischler

Create model for player, the Warrior.

<img width="300"  alt="Warrior" src="{{site.imgpath}}/Warrior.png">

It is a warrior model without head, beacuse the game is a First Person Game.
Motivation comes from the Link of Legend of Zelda last century.

Also Created locomotion animation of Warrior.

Refined Bow model and rig.

By Guanpu Tian


## Level progression

Dungeon creation now places a trapdoor in the room furthest away from the player.
Interacting with the trapdoor after clearing the level takes the player to the next level (simply incrementing a level variable and reloading the scene).
A level counts as completed after all enemies have been eliminated. We could also add other conditions, e.g. finding a specific object (key).

To keep data across levels, a class is added which stores references to the required data
and persists across scene reloads.

The persistent data is registered to the game saving system developed by David.

## Player Upgrades

The player can now upgrade their stats using XP. For this, logic for defining upgrade cost is added. Further, a UI is added that shows current stat levels and allows the player to upgrade them.

<img width="300"  alt="Upgrade UI" src="{{site.imgpath}}/upgrade-ui.png">

Other small contributions: Improved gamepad mappings for UIs and stick-based camera movement. Added the assets for table and trapdoor to the respective prefabs.

By Axel Schneewind

## Game Saving
The game can now save to Disk.
This allows for things like collected coins and player levels, to not only be kept between runs, but also between game executions.

For that i implemented a generall serialisation/deserialisation functionality. because i wanted it to use different criteria the the unity build in system.
I also designed it so it is very easy to use if you want to save something. You just have to subsribe your object and mark all fields with attributes.

Something else that was very important to me was the storage path. I can get often very annoyed by games saving into randome folders like `documents`.
So i set it to store in `~/.local/share` on linux and `%USERPROFILE%\samve games`... i ignored mac os, i have no idea where to save there and we dont have a test system.
 
By David Ruff

## Correcting the Wall Creation

The Dungeon generation wasn't working perfectly. The Walls weren't reaching the corner of the rooms, Walls with Scale 0 were created which looked like a black sun (see ref).
So this week I fixed these problems. The scaling probleme was fixed quite easy, since I rotate the Wall prefab at the instantiation, I don't have to scale it along the z-Axis but the x-Axis.
For the second probleme I corrected the scaling and positioning of the Wall Objects. I placed the Pillar Asset Rene
created in the corners and with that it looked way better, although I noticed that for a corridor one wall wasn't generated, so some bugs remain which have to be fixed soon.

<img width="300"  alt="Black Sun" src="{{site.imgpath}}/black_sun.png">

By Sven Gerber

## Combat System & Enemy Behavior

Further work has been done to improve the animation controller and the way how the enemies perceive the player, as well as some tuning on their combat behavior. A few small issues were fixed with wrong state changes in the state machine of the animation controller, and a blend tree has been added that is now used to seamlessly interpolate between a forward, backward, left and right walking animation depending on the direction of the opponent's velocity.
In combat, enemies now target a position that is a little in front of the player, but still close enough so that their attack range is enough for a hit. When an enemy drops below 50% health, they will become more cautious and try to avoid getting hit any further.
Previously, enemies would automatically become aware of the player when he was within a certain range. Now, multiple factors are taken into account: The enemies still have a limited perception range, but they can only perceive the player if he is within a 120 degree cone that is in front of the enemy. They also cannot see the player if a wall is blocking their line of sight. When an enemy loses sight of the player, they will still go to the location that they have last seen the player at, wait there for a short while, and then return to the nav points in their spawn room.

By Moritz Mahling
